---
title: "Tidying & packaging datasets"
teaching: 30
exercises: 10
questions:
- "Which different forms can one dataset have?"
- "Which advantages and disadvantages do these forms have?"
- "Which features make a dataset more or less reusable?"
- "How can we add datasets to R packages?"
objectives:
- "Use `tidyr::gather()` to convert wide data to its long form."
keypoints:
- "Excel & co. incentivise the wide data format, which may spread variables across columns."
source: Rmd
---

```{r, include = FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("06-tidy-data-R-")
```

## Tidying our inflammation datasets

In the preparations episode, we read in, visualised, centered and rescaled a
dataset about inflammation in 60 patients measured over 40 days. Let's pretend
we need to tidy it up for further analysis and publication.

```{r inflammation-wide}
dat <- read.csv(file = "data/inflammation-01.csv", header = FALSE)
colnames(dat); rownames(dat)
```

You probably noticed that neither "patients" nor "days" is listed anywhere. Thus,
we should label the data first, starting with pseudonyms for the patients. If
this were real data from real human patients, we would have acquired the written
and informed consent to the pseudonymous data publication right in the beginning
of the study, during approval by the ethics committee of our study.

```{r inflammation-label}
patient_ID <- paste("patient", sep = "_", seq(60))
dat_labelled <- cbind(dat, patient_ID)
head(dat_labelled)
```

Now we have labelled our observations with `patient_ID` as the column/variable
name and `patient_â€¦` as the values. Next we are going to "gather" the observations,
meaning that we:

1. define `day` as the common `key` of all the `V1`, `V2`, etc. variables, 
1. define a name for the newly created column, in which the `value`s from the
   messy variables will be gathered, and
1. specify which variables we want to gather into key-value pairs.  

Because the days shouldn't remain labelled with `V`s, we also convert them to
numbers. Since `melt()` turned the variable names into factor levels of `day`,
`as.numeric()` understands that they are already in order. No `sub("V", "")` or
other character (literally) "assinations" are necessary.

dat_long$day <- as.numeric(dat_long$day)
```{r inflammation-gather}
dat_long <- tidyr::gather(dat_labelled,
                         key = "day",
                         value = "inflammation_score",
                         V1:V40)
tail(dat_long)
```

Notice the row numbers? Because we gathered observations into one column, and thus one
observation per row, the `r nrow(dat_long)` rows now are the product of the
initial `r nrow(dat)` rows and `r ncol(dat)` columns.

